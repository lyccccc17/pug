<!DOCTYPE html><html><head><title>編譯網址工具</title><link rel="icon" href="https://i.imgur.com/uvL7e25.png" type="image/x-icon"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no"><script>(function () {
  const host = location.host.split(':')[0]
  if (host === 'localhost') document.write(`<script src="http://${host}:35729/livereload.js?snipver=1"></` + 'script>')
})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"></head><body><meta name="description" content="使用 Qs 編譯多個帶參數的網址"><meta property="og:description" content="使用 Qs 編譯多個帶參數的網址"><style>[v-cloak] {
  display: none; }

body {
  margin-top: 55px; }

.input-group-text {
  width: 120px;
  background-color: white; }

textarea {
  min-height: 300px; }
</style><style>@charset "UTF-8";
body {
  font-family: 'Source Sans Pro', Helvetica, Arial, 'PingFang TC', 'Microsoft JhengHei', '微軟正黑體', sans-serif;
  letter-spacing: 0.5px; }
</style><script async src="https://www.googletagmanager.com/gtag/js?id=UA-164526128-1"></script><script>function gtag () { window.dataLayer.push(arguments) }
const host = location.host.split(':')[0]
if (host !== 'localhost') {
  window.dataLayer = window.dataLayer || []
  window.GA_MEASUREMENT_ID = 'UA-164526128-1'
  gtag('js', new Date())

  gtag('config', 'UA-164526128-1')
}</script><div class="navbar navbar-expand-md navbar-light fixed-top"><a class="navbar-brand mx-auto" href="https://yuanchi17.github.io/index.html">YUAN</a></div><style>.navbar {
  border-bottom: solid 1px #e6e6e6;
  width: 100%;
  background-color: #ffffff; }

a {
  color: #333333;
  font-weight: bold; }
</style><div class="container text-monospace mb-3" id="app" v-cloak><h3 class="pt-3 pb-2 m-0">編譯網址工具</h3><div class="input-group"><div class="input-group-prepend"><div class="input-group-text justify-content-end">前面的網址</div></div><input class="form-control" type="text" v-model="s.baseUrl" placeholder="請填寫欲編譯的網址"></div><div class="input-group my-2"><div class="input-group-prepend"><div class="input-group-text justify-content-end">參數內容</div></div><input class="form-control" type="text" v-model="s.csv" placeholder="請填寫 CSV 網址"></div><button class="btn btn-info" type="button" @click="btnEncodeUrl">編譯網址</button><div class="card mt-2" v-if="urls.length"><div class="card-body"><div class="d-flex mb-3"><h5 class="card-title m-0 my-auto mr-2 font-weight-bold">編譯後的所有網址</h5><button class="btn btn-info btn-sm" type="button" @click="btnCopy()">複製</button></div><textarea class="form-control" id="copyUrls" type="text" v-model="urls"></textarea></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios@0.20.0/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.all.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script>const SESSION_KEY = 'pug-encodeUrl'
window.sleep = t => new Promise(resolve => { setTimeout(resolve, t) })
window.httpBuildQuery = (obj) => Qs.stringify(obj, { arrayFormat: 'brackets' })
window.vm = new Vue({
  el: '#app',
  data: {
    urls: '',
    s: {
      baseUrl: '',
      csv: '',
    },
  },
  async mounted () {
    const session = JSON.parse(localStorage.getItem(SESSION_KEY))
    if (session) this.$set(this, 's', session)
    this.$watch('s', () => {
      localStorage.setItem(SESSION_KEY, JSON.stringify(this.s))
    }, { deep: true })
  },
  methods: {
    async btnEncodeUrl () {
      try {
        this.showLoading('請稍後', '編譯網址中')
        const baseUrl = this.s.baseUrl
        const row = await this.getCsv(this.s.csv)
        this.urls = _.map(row, r => baseUrl + window.httpBuildQuery(r)).join('\n')
        
        await window.sleep(100)
        this.btnCopy(true)
      } catch (err) {
        console.error(err)
        Swal.fire({ icon: 'err', title: '編譯失敗', text: err.message })
      }
    },
    async btnCopy (auto = false) {
      try {
        const obj = document.getElementById('copyUrls')
        obj.select()
        document.execCommand('copy')
        if (auto) {
          Swal.fire({ icon: 'success', title: '編譯成功', text: '已複製' })
          return
        }
        Swal.fire({ icon: 'success', title: '複製成功' })
      } catch (err) {
        console.error(err)
        Swal.fire({ icon: 'err', title: '複製失敗', text: err.message })
      }
    },
    async getCsv (url) {
      const csv = _.trim(_.get(await axios.get(url), 'data')) // _.trim：把前後多餘的空格修掉
      return _.get(Papa.parse(csv, {
        encoding: 'utf8',
        header: true,
      }), 'data', [])
    },
    async showLoading (title, text) {
      await Swal.fire({
        title,
        text,
        allowOutsideClick: false,
        showConfirmButton: false,
        willOpen: () => { Swal.showLoading() },
      })
    },
  },
})</script></body></html>